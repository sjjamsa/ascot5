<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASCOT5: wall/wall_3d.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASCOT5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_7ca5869483cf733cfbb96a3ff9b8b86b.html">wall</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">wall_3d.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>3D wall collision checks  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;<a class="el" href="math_8h_source.html">math.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="ascot5_8h_source.html">../ascot5.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="wall__3d_8h_source.html">wall_3d.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="list_8h_source.html">../list.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="octree_8h_source.html">../octree.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="print_8h_source.html">../print.h</a>&quot;</code><br />
</div>
<p><a href="wall__3d_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a95776be277218fa57c28c4b7f2154eca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a95776be277218fa57c28c4b7f2154eca">wall_3d_init_offload</a> (<a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **offload_array, int **int_offload_array)</td></tr>
<tr class="memdesc:a95776be277218fa57c28c4b7f2154eca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize 3D wall data and check inputs.  <a href="wall__3d_8c.html#a95776be277218fa57c28c4b7f2154eca">More...</a><br /></td></tr>
<tr class="separator:a95776be277218fa57c28c4b7f2154eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd94f5ab151031ee4dd86e757557c3c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#abd94f5ab151031ee4dd86e757557c3c9">wall_3d_free_offload</a> (<a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **offload_array, int **int_offload_array)</td></tr>
<tr class="memdesc:abd94f5ab151031ee4dd86e757557c3c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free offload array and reset parameters.  <a href="wall__3d_8c.html#abd94f5ab151031ee4dd86e757557c3c9">More...</a><br /></td></tr>
<tr class="separator:abd94f5ab151031ee4dd86e757557c3c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a497356fffb82793491c87d8d375761e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a497356fffb82793491c87d8d375761e3">wall_3d_init</a> (<a class="el" href="structwall__3d__data.html">wall_3d_data</a> *w, <a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *offload_array, int *int_offload_array)</td></tr>
<tr class="memdesc:a497356fffb82793491c87d8d375761e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize wall data struct on target.  <a href="wall__3d_8c.html#a497356fffb82793491c87d8d375761e3">More...</a><br /></td></tr>
<tr class="separator:a497356fffb82793491c87d8d375761e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1420772005932496348e1ce1fbb06587"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a1420772005932496348e1ce1fbb06587">wall_3d_init_tree</a> (<a class="el" href="structwall__3d__data.html">wall_3d_data</a> *w, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *offload_array)</td></tr>
<tr class="memdesc:a1420772005932496348e1ce1fbb06587"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct wall octree iteratively.  <a href="wall__3d_8c.html#a1420772005932496348e1ce1fbb06587">More...</a><br /></td></tr>
<tr class="separator:a1420772005932496348e1ce1fbb06587"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab918f99749efff559370a4e45004412b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#ab918f99749efff559370a4e45004412b">wall_3d_init_octree</a> (<a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *w, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *offload_array, int **tree_array)</td></tr>
<tr class="memdesc:ab918f99749efff559370a4e45004412b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct wall octree recursively.  <a href="wall__3d_8c.html#ab918f99749efff559370a4e45004412b">More...</a><br /></td></tr>
<tr class="separator:ab918f99749efff559370a4e45004412b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa387551bbbe9f7352a567cd466794ecc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#aa387551bbbe9f7352a567cd466794ecc">wall_3d_hit_wall</a> (<a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> phi1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> z1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r2, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> phi2, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> z2, <a class="el" href="structwall__3d__data.html">wall_3d_data</a> *wdata, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *w_coll)</td></tr>
<tr class="memdesc:aa387551bbbe9f7352a567cd466794ecc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if trajectory from (r1, phi1, z1) to (r2, phi2, z2) intersects the wall using the octree structure.  <a href="wall__3d_8c.html#aa387551bbbe9f7352a567cd466794ecc">More...</a><br /></td></tr>
<tr class="separator:aa387551bbbe9f7352a567cd466794ecc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f188446a503d514eac62491fc3fa3af"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a4f188446a503d514eac62491fc3fa3af">wall_3d_hit_wall_full</a> (<a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> phi1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> z1, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r2, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> phi2, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> z2, <a class="el" href="structwall__3d__data.html">wall_3d_data</a> *wdata, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *w_coll)</td></tr>
<tr class="memdesc:a4f188446a503d514eac62491fc3fa3af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if trajectory from (r1, phi1, z1) to (r2, phi2, z2) intersects the wall against all triangles.  <a href="wall__3d_8c.html#a4f188446a503d514eac62491fc3fa3af">More...</a><br /></td></tr>
<tr class="separator:a4f188446a503d514eac62491fc3fa3af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ecf6ad1ca68351067111cf6dfdec9b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a10ecf6ad1ca68351067111cf6dfdec9b">wall_3d_tri_in_cube</a> (<a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t2[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t3[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> bb1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> bb2[3])</td></tr>
<tr class="memdesc:a10ecf6ad1ca68351067111cf6dfdec9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if any part of a triangle is inside a box.  <a href="wall__3d_8c.html#a10ecf6ad1ca68351067111cf6dfdec9b">More...</a><br /></td></tr>
<tr class="separator:a10ecf6ad1ca68351067111cf6dfdec9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64ae89b58068702c9e084b80cd78fd1b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#a64ae89b58068702c9e084b80cd78fd1b">wall_3d_tri_collision</a> (<a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> q1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> q2[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t2[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t3[3])</td></tr>
<tr class="memdesc:a64ae89b58068702c9e084b80cd78fd1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a line segment intersects a triangle.  <a href="wall__3d_8c.html#a64ae89b58068702c9e084b80cd78fd1b">More...</a><br /></td></tr>
<tr class="separator:a64ae89b58068702c9e084b80cd78fd1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7d0f1f8ac2ab55fa76ba1dd377f689d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wall__3d_8c.html#ae7d0f1f8ac2ab55fa76ba1dd377f689d">wall_3d_quad_collision</a> (<a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> q1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> q2[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t1[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t2[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t3[3], <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> t4[3])</td></tr>
<tr class="memdesc:ae7d0f1f8ac2ab55fa76ba1dd377f689d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a line segment intersects a quad (assumed planar)  <a href="wall__3d_8c.html#ae7d0f1f8ac2ab55fa76ba1dd377f689d">More...</a><br /></td></tr>
<tr class="separator:ae7d0f1f8ac2ab55fa76ba1dd377f689d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>3D wall collision checks </p>
<p>3D wall model where wall consists of small triangles that form a surface mesh. A wall collision happens when a marker intersects a wall triangle's plane. During initialization, the computational model is divided into smaller cell using octree, and wall triangles are divided according to which cell(s) they inhabit. Collision checks are only made with respect to triangles that are in the same cell as the marker. </p>

<p class="definition">Definition in file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a95776be277218fa57c28c4b7f2154eca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95776be277218fa57c28c4b7f2154eca">&#9670;&nbsp;</a></span>wall_3d_init_offload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wall_3d_init_offload </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>int_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize 3D wall data and check inputs. </p>
<p>Before calling this function, the offload struct is expected to hold triangle positions as</p>
<p>[x1_1, y1_1, z1_1, x2_1, y2_1, z2_1, x3_1, y3_1, z3_1,... ],</p>
<p>where first index is for the triangle vertex and second for the triangle itself.</p>
<p>This function fill rest of the offload struct and constructs the octree, while also printing some values as sanity check.</p>
<p>The default octree depth is defined by macro WALL_OCTREE_DEPTH in <a class="el" href="wall__3d_8h.html" title="Header file for wall_3d.c.">wall_3d.h</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">offload_data</td><td>pointer to offload data struct </td></tr>
    <tr><td class="paramname">offload_array</td><td>pointer to offload array </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>pointer to offload array containing integers</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero if initialization succeeded </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00044">44</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="abd94f5ab151031ee4dd86e757557c3c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd94f5ab151031ee4dd86e757557c3c9">&#9670;&nbsp;</a></span>wall_3d_free_offload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wall_3d_free_offload </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>int_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free offload array and reset parameters. </p>
<p>This function deallocates the offload_array.</p>
<p>This function is host only.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">offload_data</td><td>pointer to offload data struct </td></tr>
    <tr><td class="paramname">offload_array</td><td>pointer to offload array </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>pointer to offload array containing integers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00110">110</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="a497356fffb82793491c87d8d375761e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a497356fffb82793491c87d8d375761e3">&#9670;&nbsp;</a></span>wall_3d_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wall_3d_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwall__3d__data.html">wall_3d_data</a> *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>int_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize wall data struct on target. </p>
<p>This function copies the wall parameters from the offload struct to the struct on target and sets the wall data pointers to correct offsets in the offload array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>pointer to data struct on target </td></tr>
    <tr><td class="paramname">offload_data</td><td>pointer to offload data struct </td></tr>
    <tr><td class="paramname">offload_array</td><td>offload array </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>offload array containing integers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00131">131</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="a1420772005932496348e1ce1fbb06587"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1420772005932496348e1ce1fbb06587">&#9670;&nbsp;</a></span>wall_3d_init_tree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wall_3d_init_tree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwall__3d__data.html">wall_3d_data</a> *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct wall octree iteratively. </p>
<p>Constructs the octree array by iterating through all wall triangles and octree grid to identify triangles belonging to each grid cell.</p>
<p>Slow, only for testing purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>pointer to wall data </td></tr>
    <tr><td class="paramname">offload_array</td><td>offload array </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00162">162</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="ab918f99749efff559370a4e45004412b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab918f99749efff559370a4e45004412b">&#9670;&nbsp;</a></span>wall_3d_init_octree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wall_3d_init_octree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwall__3d__offload__data.html">wall_3d_offload_data</a> *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>tree_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct wall octree recursively. </p>
<p>Constructs the octree array by iterating through all wall triangles and placing them into an octree structure</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>pointer to wall data </td></tr>
    <tr><td class="paramname">offload_array</td><td>the offload array </td></tr>
    <tr><td class="paramname">tree_array</td><td>pointer to array storing what octree cells contain which triangles </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00242">242</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="aa387551bbbe9f7352a567cd466794ecc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa387551bbbe9f7352a567cd466794ecc">&#9670;&nbsp;</a></span>wall_3d_hit_wall()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wall_3d_hit_wall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>r1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>phi1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>z1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>r2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>phi2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>z2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwall__3d__data.html">wall_3d_data</a> *&#160;</td>
          <td class="paramname"><em>wdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>w_coll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if trajectory from (r1, phi1, z1) to (r2, phi2, z2) intersects the wall using the octree structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r1</td><td>start point R coordinate [m] </td></tr>
    <tr><td class="paramname">phi1</td><td>start point phi coordinate [rad] </td></tr>
    <tr><td class="paramname">z1</td><td>start point z coordinate [rad] </td></tr>
    <tr><td class="paramname">r2</td><td>end point R coordinate [m] </td></tr>
    <tr><td class="paramname">phi2</td><td>end point phi coordinate [rad] </td></tr>
    <tr><td class="paramname">z2</td><td>end point z coordinate [rad] </td></tr>
    <tr><td class="paramname">wdata</td><td>pointer to data struct on target </td></tr>
    <tr><td class="paramname">w_coll</td><td>pointer for storing the parameter in P = P1 + w_coll * (P2-P1), where P is the point where the collision occurred.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>id, which is the first element id if hit, zero otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00339">339</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="a4f188446a503d514eac62491fc3fa3af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f188446a503d514eac62491fc3fa3af">&#9670;&nbsp;</a></span>wall_3d_hit_wall_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wall_3d_hit_wall_full </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>r1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>phi1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>z1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>r2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>phi2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>z2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwall__3d__data.html">wall_3d_data</a> *&#160;</td>
          <td class="paramname"><em>wdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>w_coll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if trajectory from (r1, phi1, z1) to (r2, phi2, z2) intersects the wall against all triangles. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r1</td><td>start point R coordinate [m] </td></tr>
    <tr><td class="paramname">phi1</td><td>start point phi coordinate [rad] </td></tr>
    <tr><td class="paramname">z1</td><td>start point z coordinate [rad] </td></tr>
    <tr><td class="paramname">r2</td><td>end point R coordinate [m] </td></tr>
    <tr><td class="paramname">phi2</td><td>end point phi coordinate [rad] </td></tr>
    <tr><td class="paramname">z2</td><td>end point z coordinate [rad] </td></tr>
    <tr><td class="paramname">wdata</td><td>pointer to data struct on target </td></tr>
    <tr><td class="paramname">w_coll</td><td>pointer for storing the parameter in P = P1 + w_coll * (P2-P1), where P is the point where the collision occurred.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>id is wall element id if hit, zero otherwise* </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00419">419</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="a10ecf6ad1ca68351067111cf6dfdec9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10ecf6ad1ca68351067111cf6dfdec9b">&#9670;&nbsp;</a></span>wall_3d_tri_in_cube()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wall_3d_tri_in_cube </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t2</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t3</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>bb1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>bb2</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if any part of a triangle is inside a box. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t1</td><td>xyz coordinates of first triangle vertex [m] </td></tr>
    <tr><td class="paramname">t2</td><td>xyz coordinates of second triangle vertex [m] </td></tr>
    <tr><td class="paramname">t3</td><td>xyz coordinates of third triangle vertex [m] </td></tr>
    <tr><td class="paramname">bb1</td><td>bounding box minimum xyz coordinates [m] </td></tr>
    <tr><td class="paramname">bb2</td><td>bounding box maximum xyz coordinates [m]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero if not any part of the triangle is within the box </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00464">464</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="a64ae89b58068702c9e084b80cd78fd1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64ae89b58068702c9e084b80cd78fd1b">&#9670;&nbsp;</a></span>wall_3d_tri_collision()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double wall_3d_tri_collision </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>q1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>q2</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t2</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t3</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if a line segment intersects a triangle. </p>
<p>This routine implements the MÃ¶ller-Trumbore algorithm.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q1</td><td>line segment start point xyz coordinates [m] </td></tr>
    <tr><td class="paramname">q2</td><td>line segment end point xyz coordinates [m] </td></tr>
    <tr><td class="paramname">t1</td><td>xyz coordinates of first triangle vertex [m] </td></tr>
    <tr><td class="paramname">t2</td><td>xyz coordinates of second triangle vertex [m] </td></tr>
    <tr><td class="paramname">t3</td><td>xyz coordinates of third triangle vertex [m]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A positive number w which is defined so that vector q1 + w*(q2-q1) is the intersection point. A negative number is returned if no there is no intersection </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00544">544</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
<a id="ae7d0f1f8ac2ab55fa76ba1dd377f689d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7d0f1f8ac2ab55fa76ba1dd377f689d">&#9670;&nbsp;</a></span>wall_3d_quad_collision()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wall_3d_quad_collision </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>q1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>q2</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t1</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t2</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t3</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>&#160;</td>
          <td class="paramname"><em>t4</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if a line segment intersects a quad (assumed planar) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q1</td><td>line segment start point xyz coordinates [m] </td></tr>
    <tr><td class="paramname">q2</td><td>line segment end point xyz coordinates [m] </td></tr>
    <tr><td class="paramname">t1</td><td>xyz coordinates of first quad vertex [m] </td></tr>
    <tr><td class="paramname">t2</td><td>xyz coordinates of second quad vertex [m] </td></tr>
    <tr><td class="paramname">t3</td><td>xyz coordinates of third quad vertex [m] </td></tr>
    <tr><td class="paramname">t4</td><td>xyz coordinates of fourth quad vertex [m]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Zero if no intersection, positive number otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="wall__3d_8c_source.html#l00619">619</a> of file <a class="el" href="wall__3d_8c_source.html">wall_3d.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 3 2023 12:32:41 for ASCOT5 by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
